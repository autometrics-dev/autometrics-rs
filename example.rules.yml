---
# Prometheus recording and alerting rules generated by autometrics-rs

groups:
- name: autometrics-slo-sli-recordings-alerts-get_index_handler-success-rate
  rules:
  - record: slo:sli_error:ratio_rate5m
    expr: sum(rate(function_calls_count{function="get_index_handler",module="alerts",result="error"}[5m])) / sum(rate(function_calls_count{function="get_index_handler",module="alerts"}[5m]))
    labels:
      objective: success-rate
      function: get_index_handler
      module: alerts
      window: 5m
  - record: slo:sli_error:ratio_rate30m
    expr: sum(rate(function_calls_count{function="get_index_handler",module="alerts",result="error"}[30m])) / sum(rate(function_calls_count{function="get_index_handler",module="alerts"}[30m]))
    labels:
      objective: success-rate
      function: get_index_handler
      module: alerts
      window: 30m
  - record: slo:sli_error:ratio_rate1h
    expr: sum(rate(function_calls_count{function="get_index_handler",module="alerts",result="error"}[1h])) / sum(rate(function_calls_count{function="get_index_handler",module="alerts"}[1h]))
    labels:
      objective: success-rate
      function: get_index_handler
      module: alerts
      window: 1h
  - record: slo:sli_error:ratio_rate2h
    expr: sum(rate(function_calls_count{function="get_index_handler",module="alerts",result="error"}[2h])) / sum(rate(function_calls_count{function="get_index_handler",module="alerts"}[2h]))
    labels:
      objective: success-rate
      function: get_index_handler
      module: alerts
      window: 2h
  - record: slo:sli_error:ratio_rate6h
    expr: sum(rate(function_calls_count{function="get_index_handler",module="alerts",result="error"}[6h])) / sum(rate(function_calls_count{function="get_index_handler",module="alerts"}[6h]))
    labels:
      objective: success-rate
      function: get_index_handler
      module: alerts
      window: 6h
  - record: slo:sli_error:ratio_rate1d
    expr: sum(rate(function_calls_count{function="get_index_handler",module="alerts",result="error"}[1d])) / sum(rate(function_calls_count{function="get_index_handler",module="alerts"}[1d]))
    labels:
      objective: success-rate
      function: get_index_handler
      module: alerts
      window: 1d
  - record: slo:sli_error:ratio_rate3d
    expr: sum(rate(function_calls_count{function="get_index_handler",module="alerts",result="error"}[3d])) / sum(rate(function_calls_count{function="get_index_handler",module="alerts"}[3d]))
    labels:
      objective: success-rate
      function: get_index_handler
      module: alerts
      window: 3d
  - record: slo:sli_error:ratio_rate30d
    expr: |
      sum_over_time(slo:sli_error:ratio_rate5m{function="get_index_handler",module="alerts",objective="success-rate"}[30d])
      / ignoring(window)
      count_over_time(slo:sli_error:ratio_rate5m{function="get_index_handler",module="alerts",objective="success-rate"}[30d])
    labels:
      objective: success-rate
      function: get_index_handler
      module: alerts
      window: 30d

- name: autometrics-slo-meta-recordings-alerts-get_index_handler-success-rate
  rules:
  - record: slo:objective:ratio
    expr: vector(0.999)
    labels:
      objective: success-rate
      function: get_index_handler
      module: alerts
  - record: slo:error_budget:ratio
    expr: vector(1 - 0.999)
    labels:
      objective: success-rate
      function: get_index_handler
      module: alerts
  - record: slo:time_period:days
    expr: vector(30)
    labels:
      objective: success-rate
      function: get_index_handler
      module: alerts
  - record: slo:current_burn_rate:ratio
    expr: slo:sli_error:ratio_rate5m{function="get_index_handler",module="alerts",objective="success-rate"} / on(function, module, objective) group_left slo:error_budget:ratio{function="get_index_handler",module="alerts",objective="success-rate"}
    labels:
      objective: success-rate
      function: get_index_handler
      module: alerts
  - record: slo:period_burn_rate:ratio
    expr: slo:sli_error:ratio_rate30d{function="get_index_handler",module="alerts",objective="success-rate"} / on(function, module, objective) group_left slo:error_budget:ratio{function="get_index_handler",module="alerts",objective="success-rate"}
    labels:
      objective: success-rate
      function: get_index_handler
      module: alerts
  - record: slo:period_error_budget_remaining:ratio
    expr: 1 - slo:period_burn_rate:ratio{function="get_index_handler",module="alerts",objective="success-rate"}
    labels:
      objective: success-rate
      function: get_index_handler
      module: alerts

- name: autometrics-slo-alerts-alerts-get_index_handler-success-rate
  rules:
  - alert: HighErrorRate-alerts-get_index_handler-success-rate
    expr: |
      (
        max(slo:sli_error:ratio_rate5m{function="get_index_handler",module="alerts",objective="success-rate"} > (14.4 * (1 - 0.999)))
        and
        max(slo:sli_error:ratio_rate1h{function="get_index_handler",module="alerts",objective="success-rate"} > (14.4 * (1 - 0.999)))
      )
      or
      (
        max(slo:sli_error:ratio_rate30m{function="get_index_handler",module="alerts",objective="success-rate"} > (6 * (1 - 0.999)))
        and
        max(slo:sli_error:ratio_rate6h{function="get_index_handler",module="alerts",objective="success-rate"} > (6 * (1 - 0.999)))
      )
    labels:
      severity: pageteam
    annotations:
      summary: High error rate for function 'get_index_handler' in module 'alerts'
      title: (page) 'get_index_handler' in module 'alerts' SLO error budget burn rate is too fast.
  - alert: HighErrorRate-alerts-get_index_handler-success-rate
    expr: |
      (
        max(slo:sli_error:ratio_rate2h{function="get_index_handler",module="alerts",objective="success-rate"} > (3 * (1 - 0.999)))
        and
        max(slo:sli_error:ratio_rate1d{function="get_index_handler",module="alerts",objective="success-rate"} > (3 * (1 - 0.999)))
      )
      or
      (
        max(slo:sli_error:ratio_rate6h{function="get_index_handler",module="alerts",objective="success-rate"} > (1 * (1 - 0.999)))
        and
        max(slo:sli_error:ratio_rate3d{function="get_index_handler",module="alerts",objective="success-rate"} > (1 * (1 - 0.999)))
      )
    labels:
      severity: ticket
    annotations:
      summary: High error rate for function 'get_index_handler' in module 'alerts'
      title: (ticket) 'get_index_handler' in module 'alerts' SLO error budget burn rate is too fast.

- name: autometrics-slo-sli-recordings-alerts-get_index_handler-latency
  rules:
  - record: slo:sli_error:ratio_rate5m
    expr: (sum(rate(function_calls_duration_bucket{function="get_index_handler",module="alerts"}[5m])) - sum(rate(function_calls_duration_bucket{le="0.2",function="get_index_handler",module="alerts"}[5m]))) / sum(rate(function_calls_duration_bucket{function="get_index_handler",module="alerts"}[5m]))
    labels:
      objective: latency
      function: get_index_handler
      module: alerts
      window: 5m
  - record: slo:sli_error:ratio_rate30m
    expr: (sum(rate(function_calls_duration_bucket{function="get_index_handler",module="alerts"}[30m])) - sum(rate(function_calls_duration_bucket{le="0.2",function="get_index_handler",module="alerts"}[30m]))) / sum(rate(function_calls_duration_bucket{function="get_index_handler",module="alerts"}[30m]))
    labels:
      objective: latency
      function: get_index_handler
      module: alerts
      window: 30m
  - record: slo:sli_error:ratio_rate1h
    expr: (sum(rate(function_calls_duration_bucket{function="get_index_handler",module="alerts"}[1h])) - sum(rate(function_calls_duration_bucket{le="0.2",function="get_index_handler",module="alerts"}[1h]))) / sum(rate(function_calls_duration_bucket{function="get_index_handler",module="alerts"}[1h]))
    labels:
      objective: latency
      function: get_index_handler
      module: alerts
      window: 1h
  - record: slo:sli_error:ratio_rate2h
    expr: (sum(rate(function_calls_duration_bucket{function="get_index_handler",module="alerts"}[2h])) - sum(rate(function_calls_duration_bucket{le="0.2",function="get_index_handler",module="alerts"}[2h]))) / sum(rate(function_calls_duration_bucket{function="get_index_handler",module="alerts"}[2h]))
    labels:
      objective: latency
      function: get_index_handler
      module: alerts
      window: 2h
  - record: slo:sli_error:ratio_rate6h
    expr: (sum(rate(function_calls_duration_bucket{function="get_index_handler",module="alerts"}[6h])) - sum(rate(function_calls_duration_bucket{le="0.2",function="get_index_handler",module="alerts"}[6h]))) / sum(rate(function_calls_duration_bucket{function="get_index_handler",module="alerts"}[6h]))
    labels:
      objective: latency
      function: get_index_handler
      module: alerts
      window: 6h
  - record: slo:sli_error:ratio_rate1d
    expr: (sum(rate(function_calls_duration_bucket{function="get_index_handler",module="alerts"}[1d])) - sum(rate(function_calls_duration_bucket{le="0.2",function="get_index_handler",module="alerts"}[1d]))) / sum(rate(function_calls_duration_bucket{function="get_index_handler",module="alerts"}[1d]))
    labels:
      objective: latency
      function: get_index_handler
      module: alerts
      window: 1d
  - record: slo:sli_error:ratio_rate3d
    expr: (sum(rate(function_calls_duration_bucket{function="get_index_handler",module="alerts"}[3d])) - sum(rate(function_calls_duration_bucket{le="0.2",function="get_index_handler",module="alerts"}[3d]))) / sum(rate(function_calls_duration_bucket{function="get_index_handler",module="alerts"}[3d]))
    labels:
      objective: latency
      function: get_index_handler
      module: alerts
      window: 3d
  - record: slo:sli_error:ratio_rate30d
    expr: |
      sum_over_time(slo:sli_error:ratio_rate5m{function="get_index_handler",module="alerts",objective="latency"}[30d])
      / ignoring(window)
      count_over_time(slo:sli_error:ratio_rate5m{function="get_index_handler",module="alerts",objective="latency"}[30d])
    labels:
      objective: latency
      function: get_index_handler
      module: alerts
      window: 30d

- name: autometrics-slo-meta-recordings-alerts-get_index_handler-latency
  rules:
  - record: slo:objective:ratio
    expr: vector(0.999)
    labels:
      objective: latency
      function: get_index_handler
      module: alerts
  - record: slo:error_budget:ratio
    expr: vector(1 - 0.999)
    labels:
      objective: latency
      function: get_index_handler
      module: alerts
  - record: slo:time_period:days
    expr: vector(30)
    labels:
      objective: latency
      function: get_index_handler
      module: alerts
  - record: slo:current_burn_rate:ratio
    expr: slo:sli_error:ratio_rate5m{function="get_index_handler",module="alerts",objective="latency"} / on(function, module, objective) group_left slo:error_budget:ratio{function="get_index_handler",module="alerts",objective="latency"}
    labels:
      objective: latency
      function: get_index_handler
      module: alerts
  - record: slo:period_burn_rate:ratio
    expr: slo:sli_error:ratio_rate30d{function="get_index_handler",module="alerts",objective="latency"} / on(function, module, objective) group_left slo:error_budget:ratio{function="get_index_handler",module="alerts",objective="latency"}
    labels:
      objective: latency
      function: get_index_handler
      module: alerts
  - record: slo:period_error_budget_remaining:ratio
    expr: 1 - slo:period_burn_rate:ratio{function="get_index_handler",module="alerts",objective="latency"}
    labels:
      objective: latency
      function: get_index_handler
      module: alerts

- name: autometrics-slo-alerts-alerts-get_index_handler-latency
  rules:
  - alert: HighErrorRate-alerts-get_index_handler-latency
    expr: |
      (
        max(slo:sli_error:ratio_rate5m{function="get_index_handler",module="alerts",objective="latency"} > (14.4 * (1 - 0.999)))
        and
        max(slo:sli_error:ratio_rate1h{function="get_index_handler",module="alerts",objective="latency"} > (14.4 * (1 - 0.999)))
      )
      or
      (
        max(slo:sli_error:ratio_rate30m{function="get_index_handler",module="alerts",objective="latency"} > (6 * (1 - 0.999)))
        and
        max(slo:sli_error:ratio_rate6h{function="get_index_handler",module="alerts",objective="latency"} > (6 * (1 - 0.999)))
      )
    labels:
      severity: pageteam
    annotations:
      summary: High error rate for function 'get_index_handler' in module 'alerts'
      title: (page) 'get_index_handler' in module 'alerts' SLO error budget burn rate is too fast.
  - alert: HighErrorRate-alerts-get_index_handler-latency
    expr: |
      (
        max(slo:sli_error:ratio_rate2h{function="get_index_handler",module="alerts",objective="latency"} > (3 * (1 - 0.999)))
        and
        max(slo:sli_error:ratio_rate1d{function="get_index_handler",module="alerts",objective="latency"} > (3 * (1 - 0.999)))
      )
      or
      (
        max(slo:sli_error:ratio_rate6h{function="get_index_handler",module="alerts",objective="latency"} > (1 * (1 - 0.999)))
        and
        max(slo:sli_error:ratio_rate3d{function="get_index_handler",module="alerts",objective="latency"} > (1 * (1 - 0.999)))
      )
    labels:
      severity: ticket
    annotations:
      summary: High error rate for function 'get_index_handler' in module 'alerts'
      title: (ticket) 'get_index_handler' in module 'alerts' SLO error budget burn rate is too fast.


